
name: devsecops-ai-platform
services:
  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    container_name: devsecops-ai-platform-api
    environment:
      - NODE_ENV=production
      - PORT=3000
    ports:
      - "${API_PORT_HOST:-5858}:3000"
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000/health',res=>process.exit(res.statusCode===200?0:1)).on('error',()=>process.exit(1))"]
      interval: 5s
      timeout: 3s
      retries: 10
    networks:
      - devnet

  ai:
    build:
      context: ./ai
      dockerfile: Dockerfile
    container_name: devsecops-ai-platform-ai
    environment:
      - FLASK_ENV=production
      - PORT=5000
    ports:
      - "${AI_PORT_HOST:-5859}:5000"
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request,sys; sys.exit(0) if urllib.request.urlopen('http://localhost:5000/health', timeout=2).status==200 else sys.exit(1)"]
      interval: 5s
      timeout: 3s
      retries: 10
    networks:
      - devnet

networks:
  devnet:
    driver: bridge
